require 'meta.rb'

class Photo < MetaRecord
  # inherits :metadata from MetaRecord
  # inherits instance method meta(data) from MetaRecord  
  mount_uploader :photo, PhotoUploader  

  def as_json(options=nil)
    owner = Observation.where(:photo_id=>id).first() || Report.where(:photo_id=>id).first() || nil
    if owner.nil?
      return
    end
    owner_type = owner.class.name.downcase
    owner_id = owner.id
    lat = owner.lat
    lon = owner.lon
    url = Photo.find(id).photo.url 
    
    ret = {
      :id=>id,
      :url=>url,
      :owner_type=>owner_type,
      :owner_id=>owner_id,
      :lat=>lat,
      :lon=>lon
    }
    return ret
  end
end
