require 'meta.rb'

class Observation < MetaRecord
  attr_accessible :user_id, :lat, :lon, :timestamp, :participants, :guardian, :rcs_test_kit_use, :photo, :comment, :metrics # inherits :metadata from MetaRecord

  has_many :metrics

  # inherits instance method meta(data) from MetaRecord  

  def as_json(options=nil)
    ret = {
      :observer=>User.find(user_id),
      :id=>id,
      :lat=>lat,
      :lon=>lon,
      :timestamp=>timestamp,
      :participants=>participants,
      :guardian=>guardian,
      :rcs_test_kit_use=>rcs_test_kit_use,
      :photo=>photo,
      :comment=>comment,
      :metadata=>metadata,
      :metrics_count=>metrics.length
    }
    if options[:with_metrics]
      ret[:metrics] = metrics
    end
    return ret
  end
end

